<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ Ø³Ù…Ø§Ø³ÙŠÙ…Ùˆ â€” VIP</title>
<style>
  /* -------------------------
     Baseline & background
     -------------------------*/
  :root{
    --pink:#ff6fa8;
    --pink-dark:#ff3b87;
    --gold:#d4af37;
    --emerald:#0a7f5f;
    --bg1:#1b0216;
    --text:#2b0a1a;
  }
  html,body{
    height:100%;
    margin:0;
    padding:0;
    font-family: "Tajawal", "Poppins", system-ui, sans-serif;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.02), transparent 10%),
                linear-gradient(135deg,#ffdfe9 0%, #ffb3d6 30%, #ff8ac2 60%, #ff63b0 100%);
    overflow:hidden;
    color:var(--text);
  }

  /* subtle animated background sheen */
  .bg-rays{
    position:fixed; inset:0; pointer-events:none; z-index:0;
    background: radial-gradient(circle at 10% 20%, rgba(255,255,255,0.06), transparent 8%),
                radial-gradient(circle at 90% 80%, rgba(255,255,255,0.04), transparent 10%);
    mix-blend-mode: overlay;
    animation: bgPulse 12s ease-in-out infinite;
    opacity:0.95;
  }
  @keyframes bgPulse {
    0%{filter:brightness(1)}
    50%{filter:brightness(1.06)}
    100%{filter:brightness(1)}
  }

  /* container layout */
  .wrap{
    position:relative;
    min-height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:18px;
    z-index:2;
    padding:28px;
    box-sizing:border-box;
  }

  h1{
    margin:6px 0 0 0;
    font-size:28px;
    color:#fff;
    text-shadow:0 6px 30px rgba(255,120,170,0.18);
    letter-spacing:1px;
  }
  p.subtitle{
    margin:0;
    color:rgba(255,255,255,0.88);
    opacity:0.9;
    font-size:14px;
  }

  /* -------------------------
     Envelope area (3D-ish)
     -------------------------*/
  .stage{
    position:relative;
    width:360px;
    max-width:92vw;
    height:420px;
    display:flex;
    align-items:center;
    justify-content:center;
    perspective:1200px;
    z-index:5;
  }

  /* 3D envelope box */
  .envelope-3d{
    width:320px;
    height:200px;
    position:relative;
    transform-style:preserve-3d;
    transition: transform 0.9s cubic-bezier(.2,.9,.25,1);
  }

  /* back of envelope for depth */
  .env-back{
    position:absolute; inset:0;
    border-radius:14px;
    background:linear-gradient(180deg,#fff,#ffeef3);
    box-shadow: 0 18px 50px rgba(10,6,12,0.25), 0 6px 18px rgba(0,0,0,0.18);
    transform: translateZ(-8px);
  }

  /* flap (triangular top) */
  .env-flap{
    position:absolute;
    width:100%;
    height:100%;
    top:0; left:0;
    transform-origin: top center;
    transition: transform 0.9s cubic-bezier(.2,.9,.25,1);
    z-index:8;
    pointer-events:none;
  }

  .env-flap svg{
    display:block;
    width:100%;
    height:100%;
    border-radius:14px;
  }

  /* envelope body (front) */
  .env-front{
    position:absolute; inset:0;
    border-radius:14px;
    overflow:hidden;
    z-index:6;
    display:flex;
    align-items:center;
    justify-content:center;
    transform: translateZ(6px);
  }
  .env-front .band{
    position:absolute; left:0; right:0; top:50%; height:48px;
    transform:translateY(-50%);
    background:linear-gradient(90deg, rgba(255,122,180,0.95), rgba(212,175,55,0.85));
    opacity:0.95;
    mix-blend-mode: screen;
  }

  /* open state classes */
  .envelope-3d.open{
    transform: rotateX(6deg) rotateY(0deg) translateY(-6px) scale(1.01);
  }
  .envelope-3d.open .env-flap{
    transform: rotateX(180deg) translateY(-120px);
  }

  /* letter paper (initially hidden inside) */
  .paper{
    position:absolute;
    width:86%;
    left:7%;
    top:12%;
    height:80%;
    background:#fff;
    border-radius:8px;
    box-shadow:0 10px 40px rgba(0,0,0,0.18);
    transform-origin:center;
    transform: translateZ(1px) translateY(34%);
    opacity:0;
    transition: transform 1.0s cubic-bezier(.2,.9,.25,1), opacity 1.0s;
    padding:22px;
    box-sizing:border-box;
    color:#240014;
    overflow:auto;
  }
  .envelope-3d.open .paper{
    transform: translateZ(1px) translateY(-6%);
    opacity:1;
  }

  /* paper header styling */
  .paper h2{
    margin:6px 0 8px 0;
    color:var(--pink-dark);
    font-size:20px;
    text-align:right;
  }
  .paper .message{
    white-space:pre-wrap;
    font-size:15px;
    line-height:1.6;
    color:#2d0a16;
    text-align:right;
  }

  /* open button overlay (for mobile) */
  .open-overlay{
    position:absolute; bottom:-48px; left:50%; transform:translateX(-50%);
    z-index:20;
    display:flex; gap:10px;
  }
  .btn{
    background:linear-gradient(90deg,var(--pink),var(--pink-dark));
    color:#fff;
    border:none;
    padding:10px 14px;
    border-radius:12px;
    font-weight:700;
    cursor:pointer;
    box-shadow:0 8px 24px rgba(255,90,150,0.14);
  }
  .btn.secondary{
    background:linear-gradient(90deg,#fff,#fff);
    color:var(--pink-dark);
    border:1px solid rgba(0,0,0,0.06);
  }

  /* -------------------------
     Balloons (lots) and particles
     -------------------------*/
  .balloons-root{
    position:fixed;
    inset:auto 0 0 0;
    height:60vh;
    pointer-events:none;
    z-index:3;
  }

  .balloon{
    position:absolute;
    bottom:-160px;
    width:44px;
    height:58px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:14px;
    color:white;
    box-shadow:0 8px 26px rgba(0,0,0,0.18);
    transform-origin:center;
    animation: floatSlow linear infinite;
  }
  .balloon .string{
    position:absolute;
    bottom:-84px;
    left:50%;
    width:2px;
    height:84px;
    background:rgba(255,255,255,0.12);
    transform:translateX(-50%);
  }
  @keyframes floatSlow {
    0%{ transform: translateY(0) rotate(-6deg); opacity:0.98;}
    50%{ transform: translateY(-40vh) rotate(6deg); opacity:0.95;}
    100%{ transform: translateY(-90vh) rotate(-6deg); opacity:0;}
  }

  /* confetti canvas overlay */
  #confettiCanvas{
    position:fixed; inset:0; pointer-events:none; z-index:7;
  }

  /* heart particles (small) */
  .hearts{
    position:fixed; inset:0; pointer-events:none; z-index:4;
  }

  /* music control small */
  .controls-bar{
    position:fixed; top:18px; left:18px; z-index:30; display:flex; gap:10px; align-items:center;
  }
  .controls-bar .small{
    background:rgba(255,255,255,0.08);
    padding:8px 10px;
    border-radius:999px;
    color:#fff;
    font-weight:700;
    border:1px solid rgba(255,255,255,0.06);
  }

  /* responsive tweaks */
  @media (max-width:480px){
    .stage{ height:380px }
    .envelope-3d{ width:280px; height:180px }
    .paper{ width:88%; padding:16px; font-size:14px }
  }
</style>
</head>
<body>

<!-- background rays -->
<div class="bg-rays" aria-hidden="true"></div>

<!-- music + sound -->
<audio id="bgMusic" loop preload="auto">
  <!-- Replace src or upload music.mp3 in repo root -->
  <source src="music.mp3" type="audio/mpeg">
  Your browser does not support audio.
</audio>
<!-- small pop sound for open -->
<audio id="popSound" preload="auto">
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_316c2545da.mp3?filename=click-1-6233.mp3" type="audio/mpeg">
</audio>

<!-- controls top-left -->
<div class="controls-bar" aria-hidden="false">
  <button class="small btn" id="musicBtn">ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰</button>
  <button class="small btn secondary" id="stopBalloons">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø§Ù„ÙˆÙ†Ø§Øª</button>
</div>

<div class="wrap" role="main" aria-labelledby="title">
  <h1 id="title">Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ Ø³Ø¹ÙŠØ¯ ÙŠØ§ <span style="color:#fff">Samasimo</span> ğŸ€</h1>
  <p class="subtitle">Ø¥Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¸Ø±Ù Ù„ÙØªØ­ Ø§Ù„Ø±Ø³Ø§Ù„Ø© â€” ÙƒÙ„ Ø´ÙŠØ¡ Ù…ÙØ¹Ø¯ Ø¨Ø·Ø±ÙŠÙ‚Ø© VIP</p>

  <div class="stage" aria-hidden="false">
    <!-- confetti canvas -->
    <canvas id="confettiCanvas"></canvas>

    <!-- 3D envelope -->
    <div class="envelope-3d" id="envelope3d" role="button" aria-pressed="false" tabindex="0">
        <div class="env-back" aria-hidden="true"></div>

        <!-- flap is built with SVG so it looks nice and smooth -->
        <div class="env-flap" id="flap">
          <svg viewBox="0 0 100 100" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs>
              <linearGradient id="g1" x1="0" x2="1">
                <stop offset="0%" stop-color="#ffd9e8"/>
                <stop offset="50%" stop-color="#ff7ab6"/>
                <stop offset="100%" stop-color="#ff5ba0"/>
              </linearGradient>
              <filter id="f1" x="-50%" y="-50%" width="200%" height="200%">
                <feDropShadow dx="0" dy="6" stdDeviation="10" flood-color="#ff8ab0" flood-opacity="0.25"/>
              </filter>
            </defs>
            <polygon points="0,0 100,0 50,85" fill="url(#g1)" filter="url(#f1)"/>
          </svg>
        </div>

        <div class="env-front" aria-hidden="true">
          <div class="band" aria-hidden="true"></div>
        </div>

        <!-- paper (inside) -->
        <div class="paper" id="paper" aria-hidden="true">
          <h2 style="text-align:right;margin-bottom:8px">Ø¥Ù„Ù‰ Ø³Ù…Ø§Ø³ÙŠÙ…Ùˆâ€¦</h2>
          <div class="message" id="message"></div>
        </div>
    </div>

    <div class="open-overlay" aria-hidden="true">
      <button class="btn" id="openBtn">Ø§ÙØªØ­ Ø§Ù„Ø¸Ø±Ù ğŸ’Œ</button>
      <button class="btn secondary" id="replayBtn" style="display:none">Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­</button>
    </div>
  </div>
</div>

<!-- balloons root -->
<div class="balloons-root" id="balloonsRoot" aria-hidden="true"></div>
<!-- hearts -->
<div class="hearts" id="heartsRoot" aria-hidden="true"></div>

<script>
/* ===============================
   Variables & content (message)
   =============================== */
const MESSAGE_TEXT = `ÙƒÙ„ Ø³Ù†Ø© ÙˆØ¥Ù†Ùƒ Ø¨Ø®ÙŠØ±â€¦
ÙˆÙŠÙ…ÙƒÙ† Ø¯ÙŠ Ø£ØºØ±Ø¨ Ù…Ø¹Ø§ÙŠØ¯Ø© ÙÙŠ Ø­ÙŠØ§ØªÙŠØŒ
Ù…Ø´ Ø¨Ø³ Ø¹Ù„Ø´Ø§Ù† Ø§Ù„Ø¸Ø±ÙˆÙ Ø§Ù„Ù„ÙŠ Ø¨ÙŠÙ†Ø§â€¦
Ù„ÙƒÙ† Ø¹Ù„Ø´Ø§Ù† Ø¯ÙŠ Ø£ÙˆÙ„ Ù…Ø±Ø© Ø£Ù‚ÙˆÙ„Ù‘Ùƒ "Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ Ø³Ø¹ÙŠØ¯" ÙˆØ£Ù†Ø§ Ø£ØµÙ„Ø§Ù‹ Ù…Ø´ ÙÙŠ Ø­ÙŠØ§ØªÙƒ.

Ø¨Ø³ Ù…Ù‡Ù…Ø§ Ø­ØµÙ„â€¦
ÙˆÙ„Ø§ Ø³Ù†Ø© Ù…Ù† Ø¹Ù…Ø±ÙŠ Ø¹Ø¯Ù‘Øª Ø¨Ø¯ÙˆÙ† Ù…Ø§ Ø£ÙØªÙƒØ± Ø§Ù„ÙŠÙˆÙ… Ø¯Ù‡.
ÙŠÙˆÙ… Ø§ØªÙˆÙ„Ø¯Øª ÙÙŠÙ‡ Ø­Ø¯Ù‘â€¦ ÙƒØ§Ù† ÙˆØ¬ÙˆØ¯Ù‡ Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„ÙŠØ§ Ø£Ø¬Ù…Ù„ Ù…Ù† Ø£ÙŠ Ø¹ÙŠØ¯.

Ù…ÙƒÙ†ØªØ´ Ù†Ø§ÙˆÙŠ Ø£ÙƒØªØ¨â€¦
ÙˆÙ„Ø§ Ø£Ø±Ø¬Ø¹â€¦
ÙˆÙ„Ø§ Ø£ÙØªØ­ Ø£Ø¨ÙˆØ§Ø¨ ÙƒÙ†ØªÙŠ Ø¥Ù†ØªÙ Ø§Ù„Ù„ÙŠ Ù‚ÙÙ„ØªÙŠÙ‡Ø§.
Ø¨Ø³ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø©â€¦ Ø§Ù„Ø¯Ù†ÙŠØ§ Ø²Ù‚Ù‘ØªÙ†ÙŠ Ù„ÙŠÙƒÙŠ Ø²Ù‚Ù‘Ø©.
ÙˆÙ‚Ø§Ù„ØªÙ„ÙŠ:
"Ø§ÙØªÙƒØ±â€¦ ÙˆØ§ÙØªÙƒØ±Ù‡Ø§Ù„ÙŠ."

ÙØ§ÙØªÙƒØ±ØªÙƒâ€¦
Ø§ÙØªÙƒØ±Øª Ø¶Ø­ÙƒØªÙƒ Ø§Ù„Ù„ÙŠ ÙƒØ§Ù†Øª Ø¨ØªØºÙŠÙ‘Ø± ÙŠÙˆÙ…ÙŠ ÙƒÙ„Ù‡ØŒ
Ø§ÙØªÙƒØ±Øª ÙƒÙ„Ø§Ù…ÙƒØŒ ÙˆÙ…ÙˆØ§Ù‚Ù ØµØºÙŠØ±Ø© Ø¬Ø¯Ù‹Ø§â€¦
Ø¨Ø³ Ø£Ø«Ù‘Ø±ÙˆØ§ ÙÙŠÙ‘Ù Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ø¹Ù…Ù„Ù‡Ø§Ø´ Ø­Ø¯Ù‘.

Ø¹Ø§Ø±ÙØ©â€¦
Ø£Ù†Ø§ ØºÙ„Ø·Øª ÙƒØªÙŠØ±ØŒ ÙˆØ§Ù„ÙˆØ¬Ø¹ Ø§Ù„Ù„ÙŠ Ø­ØµÙ„ Ø¨ÙŠÙ†Ø§ Ù…Ø´ Ø¨Ø³ÙŠØ·.
ÙˆØ§Ù†ØªÙŠ Ù…Ø´ÙŠØªÙŠâ€¦ ÙˆÙƒÙ†Øª ÙØ§ÙƒØ± Ø¥Ù† Ø§Ù„ÙˆÙ‚Øª Ù‡ÙŠÙ„Ù…Ù‘ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹.
Ø¨Ø³ Ø§Ù„Ù„ÙŠ Ø­ØµÙ„ Ø§Ù„Ø¹ÙƒØ³â€¦
Ø§Ù„ÙˆÙ‚Øª ÙØ¶Ù‘Ù„ ÙŠÙˆØ±ÙŠÙ†ÙŠ Ù‚Ø¯Ù‘ Ø¥ÙŠÙ‡ ÙˆØ¬ÙˆØ¯Ùƒ ÙƒØ§Ù† Ù†Ø¹Ù…Ø©.

Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø© Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ùƒâ€¦
ÙˆØ£Ù†Ø§ Ù…Ø´ Ø¬Ø§ÙŠ Ø£Ø±Ø¬Ù‘Ø¹ Ø§Ù„Ù„ÙŠ Ø±Ø§Ø­ØŒ ÙˆÙ„Ø§ Ø£Ø¹Ù…Ù„ Ø¯Ø±Ø§Ù…Ø§.
Ø£Ù†Ø§ Ø¬Ø§ÙŠ Ø£Ù‚ÙˆÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø¨Ø³â€¦
Ø¥Ù†Ùƒ ÙˆØ­Ø´ØªÙŠÙ†ÙŠ.

Ù…Ø´ ÙˆØ­Ø´Ø© Ø±Ø¬ÙˆØ¹â€¦
ÙˆØ­Ø´Ø© Ø¥Ù†Ø³Ø§Ù†Ø© ÙƒØ§Ù†Øª Ø¬Ø²Ø¡ Ù…Ù† Ø±ÙˆØ­ÙŠØŒ
ÙˆØ­Ø´Ø© Ø¶Ø­ÙƒØ©ØŒ ÙˆØ­Ù„Ø§ÙˆØ©ØŒ ÙˆØªÙØ§ØµÙŠÙ„â€¦
Ù…Ø´ Ø¹Ø§Ø±Ù Ø£ÙƒØ±Ù‡Ù‡Ø§ Ù…Ù‡Ù…Ø§ Ø­Ø§ÙˆÙ„Øª.

ÙˆÙŠÙ…ÙƒÙ† ØªØªÙØ§Ø¬Ø¦ÙŠâ€¦
Ø¥Ù† Ø¨Ø¹Ø¯ ÙƒÙ„ Ø§Ù„ÙˆÙ‚Øª Ø¯Ù‡ØŒ
Ù„Ø³Ù‡ ÙÙŠ ÙƒÙ„Ø§Ù… ÙƒØªÙŠØ± Ù†ÙØ³ÙŠ Ø£Ù‚ÙˆÙ„Ù‡â€¦
ÙˆÙ„Ø³Ù‡ ÙÙŠ Ø¬Ø²Ø¡ Ù…Ù†ÙŠâ€¦ Ø¨ÙŠØ¯Ø¹ÙŠÙ„ÙÙƒ.

ÙˆØ¨ÙŠÙ† ÙƒÙ„ Ù„ÙŠÙ„Ø© ÙˆÙ„ÙŠÙ„Ø©â€¦
ÙƒÙ†Øª Ø¨Ù„Ø§Ù‚ÙŠÙƒÙŠ ÙÙŠ Ø­Ù„Ù…ÙŠ.
Ø¹Ø§Ø±ÙØ©ØŸ
Ø§Ù„Ø­Ù„Ù… ÙƒØ§Ù† Ø¨ÙŠØ±Ø¬Ø¹Ù†ÙŠ Ù„Ø¯Ù‚Ø§ÙŠÙ‚ ÙƒÙ†Øª ÙØ§ÙƒØ±Ù‡Ø§ Ø±Ø§Ø­Øª.
ÙˆÙƒÙ†Øª Ø¨ØµØ­Ù‰â€¦
ÙˆØ£Ù‚Ø¹Ø¯ Ø³Ø§ÙƒØª Ø´ÙˆÙŠØ©ØŒ
Ø¹Ù„Ø´Ø§Ù† Ø§Ù„Ø­Ù„Ù… ÙƒØ§Ù† Ø´Ø¨Ù‡ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©â€¦
ÙˆÙŠÙ…ÙƒÙ† Ø£Ø­Ø³Ù†.

Ø¢Ù‡â€¦ ÙˆØ¨Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:
Ø¨Ø­Ø¨Ù‘ÙƒØŸ
Ø¢Ù‡â€¦
ÙˆÙ…Ø´ Ù‡Ø¯Ø§Ø±ÙŠ.
Ù„Ø³Ù‡ Ø¬ÙˆØ§ÙŠØ§ Ù†ÙØ³ Ø§Ù„Ø­Ø¨â€¦ Ø£Ù‡Ø¯Ø£â€¦ Ø£Ø¹Ù…Ù‚â€¦ ÙˆØ£ÙˆØ¶Ø­.

Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ Ø³Ø¹ÙŠØ¯ ÙŠØ§ Ø³Ù…Ø§Ø³ÙŠÙ…Ùˆâ€¦ Ø­ØªÙ‰ Ù„Ùˆ Ù…Ø´ Ù…Ø¹Ø§ÙŠØ§. ğŸ‚ğŸ’—âœ¨`;

/* ===============================
   Elements
   =============================== */
const envelope = document.getElementById('envelope3d');
const flap = document.getElementById('flap');
const paper = document.getElementById('paper');
const messageEl = document.getElementById('message');
const openBtn = document.getElementById('openBtn');
const replayBtn = document.getElementById('replayBtn');
const confettiCanvas = document.getElementById('confettiCanvas');
const music = document.getElementById('bgMusic');
const popSound = document.getElementById('popSound');
const musicBtn = document.getElementById('musicBtn');
const balloonsRoot = document.getElementById('balloonsRoot');
const heartsRoot = document.getElementById('heartsRoot');
const stopBalloons = document.getElementById('stopBalloons');

let balloonsRunning = true;

/* ===============================
   Utility: play audio safely
   =============================== */
function tryPlayAudio(a){
  a.play().catch(()=>{/* autoplay blocked */});
}

/* ===============================
   Envelope open flow
   =============================== */
function openEnvelope(){
  // add open class
  envelope.classList.add('open');
  envelope.setAttribute('aria-pressed','true');
  // play pop sound
  tryPlayAudio(popSound);
  // start confetti burst
  startConfettiBurst();
  // start balloons (they already running)
  // show paper after small delay
  setTimeout(()=> {
    paper.setAttribute('aria-hidden','false');
    // show message typed or full (we use typing effect)
    typeMessage(MESSAGE_TEXT, messageEl, 12, () => {
      // finished typing
      replayBtn.style.display = 'inline-block';
    });
    // attempt to play background music on interaction
    tryPlayAudio(music);
    // start gentle hearts
    spawnHearts(12);
  }, 700);

  // disable open button (prevent double)
  openBtn.disabled = true;
}

/* keyboard + click accessibility */
openBtn.addEventListener('click', openEnvelope);
envelope.addEventListener('click', openEnvelope);
envelope.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter' || e.key === ' '){ openEnvelope(); }
});

/* replay / reset flow */
replayBtn.addEventListener('click', () => {
  // reset
  envelope.classList.remove('open');
  messageEl.innerHTML = '';
  replayBtn.style.display = 'none';
  openBtn.disabled = false;
  // small reset for confetti (burst again)
  startConfettiBurst();
});

/* ===============================
   Typing effect
   =============================== */
let typingTimer = null;
function typeMessage(textContainer, targetEl, delay=10, cb){
  // textContainer is string, targetEl is element
  targetEl.innerHTML = '';
  let i = 0;
  function step(){
    if(i >= textContainer.length){
      if(cb) cb();
      return;
    }
    const ch = textContainer[i++];
    // escape < > for safety
    targetEl.innerHTML += ch === '\n' ? '<br/>' : (ch === '<' ? '&lt;' : (ch === '>' ? '&gt;' : ch));
    // scroll to bottom if overflows
    targetEl.parentElement.scrollTop = targetEl.parentElement.scrollHeight;
    typingTimer = setTimeout(step, delay + (ch === '\n' ? 60 : (ch === ' ' ? 0 : 6)));
  }
  step();
}

/* ===============================
   Confetti (simple particles)
   =============================== */
const confettiCtx = confettiCanvas.getContext ? confettiCanvas.getContext('2d') : null;
let confettiPieces = [];
function resizeCanvas(){
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function createConfettiPiece(x,y){
  const colors = ['#ff6fa8','#ffd6e9','#ffd27a','#ffe6f2','#ff9acb','#ffffff'];
  return {
    x:x, y:y,
    vx:(Math.random()*8 - 4),
    vy:(Math.random()*-6 - 2),
    r: 6 + Math.random()*8,
    color: colors[Math.floor(Math.random()*colors.length)],
    rot: Math.random()*360,
    vr: (Math.random()*8 - 4)
  };
}
function startConfettiBurst(){
  // create a burst around envelope center
  const rect = envelope.getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top + rect.height/3;
  for(let i=0;i<40;i++){
    confettiPieces.push(createConfettiPiece(cx + (Math.random()*60-30), cy + (Math.random()*60-30)));
  }
  // auto-clear after some time
  setTimeout(()=>{ confettiPieces = confettiPieces.slice(-80); }, 3500);
}

function confettiLoop(){
  if(!confettiCtx) return;
  confettiCtx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
  for(let i=confettiPieces.length-1;i>=0;i--){
    const p = confettiPieces[i];
    p.x += p.vx; p.y += p.vy; p.vy += 0.24; p.rot += p.vr;
    confettiCtx.save();
    confettiCtx.translate(p.x, p.y);
    confettiCtx.rotate(p.rot * Math.PI / 180);
    confettiCtx.fillStyle = p.color;
    confettiCtx.fillRect(-p.r/2, -p.r/2, p.r, p.r*0.6);
    confettiCtx.restore();
    if(p.y > confettiCanvas.height + 60) confettiPieces.splice(i,1);
  }
  requestAnimationFrame(confettiLoop);
}
confettiLoop();

/* ===============================
   Balloons spawner
   =============================== */
let balloonTimers = [];
function spawnBalloon(xPercent, color, delay, duration){
  const b = document.createElement('div');
  b.className = 'balloon';
  b.style.left = xPercent + 'vw';
  b.style.background = color;
  b.style.animationDuration = (7 + Math.random()*8) + 's';
  b.style.animationDelay = (delay||0) + 's';
  b.innerHTML = '<div class="string"></div>';
  balloonsRoot.appendChild(b);
  // remove after animation (~duration)
  setTimeout(()=>{ b.remove(); }, (parseFloat(b.style.animationDuration) * 1000) + 1200);
}
function startBalloons(intensity = 18){
  if(!balloonsRunning) return;
  for(let i=0;i<intensity;i++){
    const left = Math.random()*90;
    const palette = ['#ff9acb','#ff7ab8','#ffd6ec','#ffffff','#ffb3d9'];
    spawnBalloon(left, palette[Math.floor(Math.random()*palette.length)], Math.random()*4);
  }
  // continue spawning
  const t = setTimeout(()=> startBalloons(Math.max(6, Math.floor(intensity*0.9))), 1200 + Math.random()*1400);
  balloonTimers.push(t);
}
startBalloons(22);

/* stop balloons toggle */
stopBalloons.addEventListener('click', ()=>{
  balloonsRunning = !balloonsRunning;
  if(!balloonsRunning){
    // clear timers
    balloonTimers.forEach(t=>clearTimeout(t));
    balloonTimers = [];
    // remove existing balloons
    balloonsRoot.innerHTML = '';
    stopBalloons.textContent = 'ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø§Ù„ÙˆÙ†Ø§Øª';
  } else {
    startBalloons(18);
    stopBalloons.textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø§Ù„ÙˆÙ†Ø§Øª';
  }
});

/* ===============================
   Hearts particles
   =============================== */
function spawnHearts(count=8){
  for(let i=0;i<count;i++){
    const el = document.createElement('div');
    el.style.position='absolute';
    el.style.left = (20 + Math.random()*60) + 'vw';
    el.style.top = (50 + Math.random()*30) + 'vh';
    el.style.fontSize = (12 + Math.random()*18) + 'px';
    el.style.opacity = 0.9;
    el.style.transform = 'translateY(0) scale(1)';
    el.style.zIndex = 4;
    el.innerHTML = 'ğŸ’–';
    heartsRoot.appendChild(el);
    // animate
    const dur = 5000 + Math.random()*4000;
    el.animate([
      { transform: 'translateY(0) scale(0.6)', opacity:0.9 },
      { transform: 'translateY(-40vh) scale(1.2)', opacity:0 }
    ], { duration: dur, easing: 'ease-out' });
    setTimeout(()=> el.remove(), dur + 200);
  }
}

/* ===============================
   Music control
   =============================== */
let musicPlaying = false;
musicBtn.addEventListener('click', ()=>{
  if(music.paused){
    tryPlayAudio(music);
    musicPlaying = true;
    musicBtn.textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰';
  } else {
    music.pause();
    musicPlaying = false;
    musicBtn.textContent = 'ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰';
  }
});

/* try to autoplay quietly if allowed */
tryPlayAudio(music);

/* ===============================
   Initial state: hide message until opened
   =============================== */
messageEl.innerHTML = ''; // clear
paper.style.opacity = 0;

/* ===============================
   Keyboard accessibility: open with Enter
   =============================== */
document.addEventListener('keydown', (e)=> {
  if(e.key === 'Enter'){
    const pressed = envelope.getAttribute('aria-pressed') === 'true';
    if(!pressed) openEnvelope();
  }
});

/* ===============================
   Small polish: make sure canvas matches size
   =============================== */
function positionCanvas(){
  confettiCanvas.style.width = window.innerWidth + 'px';
  confettiCanvas.style.height = window.innerHeight + 'px';
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;
}
window.addEventListener('resize', positionCanvas);
positionCanvas();

/* ===============================
   End of script
   =============================== */
</script>

</body>
</html>
